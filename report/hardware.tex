\section{Hardware, software and architecture}
\label{sec:hardware}

In Figure~\ref{fig:arch} we show the general view of the architecture. 

To implement the VPN client and server we have used the Python 
framework and Ubuntu Linux distribution. The implementation consists 
of roughly $1.2$K lines of code (LOC) and all functions are realized 
in userspace. We have exposed the implementation in our git 
repository~\cite{impl} so that everyone can use it without any fee.

During the experiments, however, we have considered the following setup. 
For hardware, we have selected a micro instance from DigitalOcean. The 
instance had a single-core CPU, $25$ GB of data storage, $1$GB of random 
access memory, and was located in New York, USA. The VPN client was located 
in Tashkent, Uzbekistan, and was spinning on Raspberry PI microcontroller. 
This way we mimicked the SOHO router. We have also used \texttt{wget} tool to measure 
the throughput, and we have used \texttt{ping} utility to measure the round trip times. 

\section{Configuration}
\label{sec:configuration}

We assume that both server and client are 
running flavour of Debian operating system
(in our case the SOHO VPN box runs Raspberry Pi).

On fresh installation of Ubuntu, first install
\texttt{ifconfig}:

\texttt{sudo apt-get isntall net-tools}

Then, install python3, pip3 and 
needed libraries on both client and server 
machines. To install the python3, run the 
following command on both server and client:

\texttt{sudo apt-get install python3}

Next install pip3 package manager using 
the following command:

\texttt{sudo apt-get install python3-pip}

Once python3 installed, install 
required dependencies:

\texttt{sudo pip3 install python-pytun}

Next make sure you have git software 
installed:

\texttt{sudo apt-get install git}

Now everything is ready for the deployment 
of the VPN software: make a workspace directory 
somewhere on your hard drive and checkout the 
project's repository (we need to do so on both 
client and server machine as usual):

\begin{verbatim}
$ git clone https://github.com/dmitriykuptsov/soho_vpn_over_tls.git
\end{verbatim}

If needed, on server machine go to the directory 
\texttt{soho\_vpn\_over\_tls/src/server} and modify the IP address 
of the tun interface in \texttt{config.py} file (currently 
it is set to 10.0.0.1, you may leave it as it is 
if there is no conflict with your local IP address).

On SOHO box also go to directory 
\texttt{soho\_vpn\_over\_tls/src/client}
and modify the IP address of the server in the config.py 
file (currently it is 94.237.31.77, but you have to change 
it to an IP address of your own server (on server machine 
you can check the IP address either from administrative page, 
like it is offered in UpCloud or DigitalOcean, or by issuing 
ifconfig command)).

One, probably, needs to also modify the IP address of default 
gateway. Currently it is set to 10.0.2.2, but it needs to be the 
default route of your network.

Next, you need to generate password. To do so, 
do the following (replace the user test password with your own 
password):

\begin{verbatim}
$ cd soho\_vpn\_over\_tls/src
$ python3 tools/gen.py <your secure password>
\end{verbatim}

Then, copy the generated hash string and add it to the 
database.dat file in the \texttt{soho\_vpn\_over\_tls/server/} folder (you 
might also want to change the default username in that 
database file). You also need to change the password (and probably 
username) in \texttt{src/client/config.py}.

Finally, generate private key and certificate for the 
server:

\begin{verbatim}
$ cd src/certificates
$ bash generate.sh
\end{verbatim}

Then, copy the \texttt{certchain.pem} to SOHO VPN client machine
to folder \texttt{src/certificates}.

Now everything is ready to create VPN tunnel. 
On server machine, go to directory 
\texttt{soho\_vpn\_over\_tls/src} and run the 
following command:

\texttt{sudo python3 server/server.py}

On SOHO box (we use Raspberry PI as such), go to directory 
\texttt{soho\_vpn\_over\_tls/src} and run the following command:

\texttt{sudo python3 client/client.py}

On your SOHO client machine (the one, for instance, you use 
to browse the Internet) you need to modify the default gateway
so that it points to SOHO VPN box: 

\begin{verbatim}
$ sudo ip route del default
$ sudo ip route add default via 192.168.0.102
\end{verbatim}

Of course, you need to replace the \texttt{192.168.0.102}
with the IP address of you SOHO VPN box.